<html>

    <head>
        <style>

            body {
                background-color: #000;
            }

            #canvas {
                background-color: #F6E8EA;
                border: 1px solid black;
                margin: 0 auto;
                display: block;
                margin: auto;
            }

        </style>

    </head>



    <body onload="init()">
        
        <canvas id="canvas" width="600" height = "600"></canvas>


        <script type="text/javascript">

            
            var canvas = document.getElementById('canvas');
            var oL = canvas.offsetLeft;
            var oR = canvas.offsetRight;
            var oT = canvas.offsetTop;
            var ctx = canvas.getContext('2d');

            // var startButton = {
            //     timer : {
            //         started : false,
            //         completed : false,
            //         startTime : {},
            //         endTime : {}
            //     },
            //     x : 225,
            //     y : 25,
            //     width : 150,
            //     height : 35,
            //     color : '#576490',
            //     borderColor : '#493548',
            //     textColor : '#ffffff',
            //     text : 'START'
            // };
            
            var startButton = {
                timer : {
                    started : false,
                    completed : false,
                    startTime : {},
                    target : 3000
                },
                x : 225,
                y : 25,
                width : 150,
                height : 35,
                color : '#576490',
                borderColor : '#493548',
                textColor : '#ffffff',
                text : 'START'
            };
            
            var statusText = {
                x : 300,
                y : 100,
                textColor : '#000000',
                text : ''
            };

            function init () {
                ctx.textAlign = 'center';
                window.requestAnimationFrame(draw);
            }

            // click position detection function for rectangular areas
            function clickedInside (element, x, y) {
                if ( x >= element.x && x <= element.x + element.width && y >= element.y && y <= element.y + element.height ) {
                    return true;
                }
                else {
                    return false;
                }
            }

            function draw () {
                ctx.fillStyle = "#F6E8EA";
                ctx.fillRect(0, 0, 600, 600);

                // Start Button
                ctx.fillStyle = startButton.color;
                ctx.strokeStyle = startButton.borderColor;
                ctx.lineWidth = 8;
                ctx.strokeRect( startButton.x, startButton.y, startButton.width, startButton.height );
                ctx.fillRect( startButton.x, startButton.y, startButton.width, startButton.height );

                ctx.font = "lighter 18px Verdana";
                ctx.fillStyle = startButton.textColor;
                ctx.fillText( startButton.text, startButton.x + startButton.width/2, startButton.y + startButton.height/2 + 5 );

                // Status Text
                ctx.font = "lighter 12px Verdana";
                ctx.fillStyle = statusText.textColor;
                if ( !startButton.timer.completed && startButton.timer.started ) {
                    console.log(3000 - (performance.now() - startButton.timer.startTime));
                    if ( performance.now() - startButton.timer.startTime >= startButton.timer.target ) {
                        statusText.text = "Game Started!";
                        startButton.borderColor = '#80B192';
                        startButton.timer.completed = true;
                    } else {
                        statusText.text = "Starting in... " +  ((3000 - (performance.now() - startButton.timer.startTime)) / 1000).toFixed(1) + "s";
                    }
                }
                ctx.fillText( statusText.text, statusText.x, statusText.y );



                window.requestAnimationFrame(draw);
            }

            canvas.addEventListener('click', function(e) {

                var x = e.pageX - canvas.offsetLeft;
                var y = e.pageY - canvas.offsetTop;
                //console.log("mouse: " + x + " " + y);

                if ( clickedInside(startButton, x, y) ) {
                    time = performance.now();
                    //console.log("clicked start button at " + time);
                    if ( !startButton.timer.completed && !startButton.timer.started ) {
                        //console.log("starting timer!");
                        startButton.timer.started = true;
                        startButton.timer.startTime = time;
                    }
                    
                };
                
            });

        </script>

    </body>



</html>